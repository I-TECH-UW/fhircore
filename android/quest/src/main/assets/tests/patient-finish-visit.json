{
  "resourceType": "Questionnaire",
  "id": "patient-finish-visit",
  "meta": {
    "versionId": "44",
    "lastUpdated": "2022-11-30T12:56:12.610+03:00",
    "source": "#tKQ391GSck71gj9d"
  },
  "language": "en",
  "extension": [
    {
      "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-targetStructureMap",
      "valueCanonical": "https://fhir-dev.d-tree.org/StructureMap/patient-finish-visit"
    }
  ],
  "title": "Finish Visit",
  "status": "active",
  "publisher": "mcore",
  "contact": [
    {
      "name": "http://www.d-tree.org"
    }
  ],
  "item": [
    {
      "linkId": "prompt-visit-completion",
      "text": "You are completing the visit. Make sure the person knows the date of their next appointment.",
      "type": "display"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/minValue",
          "_valueDate": {
            "extension": [
              {
                "url": "http://hl7.org/fhir/StructureDefinition/cqf-calculatedValue",
                "valueExpression": {
                  "language": "text/fhirpath",
                  "expression": "today()"
                }
              }
            ]
          }
        }
      ],
      "linkId": "date-of-next-appointment",
      "text": "* <b>Enter:</b> Date of next appointment",
      "type": "date",
      "required": true
    },
    {
      "linkId": "prompt-tasks-for-next-appointment",
      "text": "Once you SAVE, the tasks for the next appointment will appear.",
      "type": "display"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Patient.meta.tag.last()"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "patient-category",
      "text": "Patient Category",
      "type": "choice",
      "required": true,
      "answerOption": [
        {
          "valueCoding": {
            "system": "https://d-tree.org",
            "code": "newly-diagnosed-client",
            "display": "Newly Diagnosed Client"
          }
        },
        {
          "valueCoding": {
            "system": "https://d-tree.org",
            "code": "client-already-on-art",
            "display": "Client Already on ART"
          }
        },
        {
          "valueCoding": {
            "system": "https://d-tree.org",
            "code": "exposed-infant",
            "display": "Exposed Infant"
          }
        },
        {
          "valueCoding": {
            "system": "https://d-tree.org",
            "code": "community-positive",
            "display": "Person Tested Positive at Community"
          }
        }
      ]
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Patient.id"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "patient-id",
      "definition": "http://hl7.org/fhir/StructureDefinition/Resource#Resource.id",
      "type": "string"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "CarePlan.id"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "care-plan-id",
      "type": "string"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Patient.gender"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "patient-gender",
      "type": "choice",
      "answerOption": [
        {
          "valueCoding": {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "male",
            "display": "Male"
          }
        },
        {
          "valueCoding": {
            "system": "http://hl7.org/fhir/administrative-gender",
            "code": "female",
            "display": "Female"
          }
        }
      ]
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Patient.birthDate"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "patient-birth-date",
      "type": "date"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "CarePlan.activity.select(detail.description.contains('Viral Load Collection')).anyTrue()"
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Patient.meta.tag.select(code.contains('newly-diagnosed-client')).anyTrue()"
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Patient.meta.tag.select(code.contains('client-already-on-art')).not()"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "newly-diagnosed-client-with-viral-load-collection",
      "text": "Newly diagnosed client with Viral Load Collection",
      "type": "boolean"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "CarePlan.select(title)"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "patient-careplan-title",
      "type": "string",
      "readOnly": true
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Practitioner.id"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "practitioner-id",
      "type": "string",
      "readOnly": true
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Practitioner.name[0].family+' '+Practitioner.name[0].given[0]"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "practitioner-fullname",
      "type": "string",
      "readOnly": true
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Patient.telecom.where(system = 'phone').exists()"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "patient-has-phone",
      "type": "boolean",
      "readOnly": true
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "CarePlan.meta[0].tag.select(code.contains('milestone-hiv-test-add-to-next-visit')).exists()"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "conduct-milestone-hiv-screening-test",
      "type": "boolean",
      "readOnly": true
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "CarePlan.meta[0].tag.select(code.contains('exposed-infant-record-hiv-test-result-add-to-next-visit')).exists()"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "conduct-exposed-infant-record-hiv-test-result",
      "type": "boolean",
      "readOnly": true
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Bundle.entry.select(resource as Bundle).where(id = 'tracing').entry.select(resource as Task).where(reasonCode.coding.code = 'linkage').select(id + ',' + executionPeriod.start.toString())"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "tracing-task-linkage",
      "type": "string"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Bundle.entry.select(resource as Bundle).where(id = 'tracing').entry.select(resource as Task).where(reasonCode.coding.code = 'interrupt-treat').select(id + ',' + executionPeriod.start.toString())"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "tracing-task-interrupt-treat",
      "type": "string"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Bundle.entry.select(resource as Bundle).where(id = 'tracing').entry.select(resource as Task).where(reasonCode.coding.code = 'miss-appt').select(id + ',' + executionPeriod.start.toString())"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "tracing-task-miss-appt",
      "type": "string"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "Bundle.entry.select(resource as Bundle).where(id = 'tracing').entry.select(resource as Task).where(reasonCode.coding.code = 'miss-routine').select(id + ',' + executionPeriod.start.toString())"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "tracing-task-miss-routine",
      "type": "string"
    }
  ]
}
