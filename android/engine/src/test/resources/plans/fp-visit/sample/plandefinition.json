{
  "resourceType": "PlanDefinition",
  "id": "cd39380b-2359-4b98-8ab9-df7f90fe9392",
  "meta": {
    "versionId": "4",
    "lastUpdated": "2022-06-21T05:58:41.499+00:00"
  },
  "contained": [
    {
      "resourceType": "ActivityDefinition",
      "id": "fp_careplan_activity",
      "title": "FP Visit",
      "status": "active",
      "description": "This is a visit for the family planning program.",
      "kind": "Task",
      "timingTiming": {
        "repeat": {
          "countMax": 5,
          "duration": 2,
          "durationMax": 4,
          "durationUnit": "h",
          "frequency": 1,
          "frequencyMax": 1,
          "period": 1,
          "periodMax": 1,
          "periodUnit": "mo"
        }
      }
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "fp_careplan_followup_activity",
      "title": "FP Follow Up Handler Activity",
      "status": "active",
      "description": "This action will assess careplan every time a followup happens on a task generated by plan",
      "kind": "CarePlan",
      "dynamicValue": [
        {
          "path": "CarePlan.status",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'completed'"
          }
        }
      ]
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "fp_careplan_referral_activity",
      "title": "FP Referral Handler Activity",
      "status": "active",
      "description": "This action will assess careplan and generate referral task every time a followup happens on a task generated by plan",
      "kind": "Task"
    }
  ],
  "name": "FP Visit",
  "title": "FP Visit",
  "status": "active",
  "description": "This is a visit for the family planning program.",
  "goal": [
    {
      "category": {
        "coding": [
          {
            "system": "https://www.hl7.org/fhir/codesystem-goal-category.html",
            "code": "nursing",
            "display": "Nursing"
          }
        ]
      },
      "priority": {
        "coding": [
          {
            "system": "https://www.hl7.org/fhir/codesystem-goal-priority.html",
            "code": "high-priority",
            "display": "High Priority"
          }
        ]
      },
      "start": {
        "coding": [
          {
            "system": "http://www.snomed.org/",
            "code": "32485007",
            "display": "Admission to hospital"
          }
        ]
      }
    }
  ],
  "action": [
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and %resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/4acc8776-32b0-4440-a1b1-a11a12d79acb').exists() and (%resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='55b1164d-7492-4635-9b83-0806fbed77d3') and ((answer.value.code = 'male-condoms') or (answer.value.code = 'female-condoms') or (answer.value.code = 'microlut-pills-(progestin-only)') or (answer.value.code = 'microgynon-pills-(combined-oral-pills)') or (answer.value.code = 'sayana-press-(depo)') or (answer.value.code = 'iud') or (answer.value.code = 'implant'))).exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='7f49d2b9-6465-4d0f-e98f-ce4bb98b8cec') and ((answer.value.code = 'male-condoms') or (answer.value.code = 'female-condoms') or (answer.value.code = 'microlut-pills-(progestin-only)') or (answer.value.code = 'microgynon-pills-(combined-oral-pills)') or (answer.value.code = 'sayana-press-(depo)') or (answer.value.code = 'iud') or (answer.value.code = 'implant') or (answer.value.code = 'the-standard-day-method-(sdm)-using-cycle-bead') or (answer.value.code = 'lactational-amenorhea-method-(lam)'))).exists())"
          }
        }
      ],
      "participant": [
        {
          "type": "practitioner",
          "role": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/practitioner-role",
                "code": "nurse",
                "display": "Nurse"
              }
            ]
          }
        }
      ],
      "type": {
        "coding": [
          {
            "code": "clinical-protocol",
            "display": "Clinical Protocol"
          }
        ]
      },
      "definitionCanonical": "#fp_careplan_activity",
      "transform": "http://hl7.org/fhir/StructureMap/132156"
    },
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and %resource.entry.where(resource is QuestionnaireResponse).resource.questionnaire = 'Questionnaire/450cb100-0c5b-47c6-9f33-2830a79be726'"
          }
        }
      ],
      "definitionCanonical": "#fp_careplan_followup_activity"
    },
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='fcb635b8-a7bc-47db-81bd-f4fe84649429' or linkId='09c960bd-940a-457e-9797-d8daf3b91d55') and answer.value.code='yes').exists()"
          }
        }
      ],
      "definitionCanonical": "#fp_careplan_referral_activity",
      "transform": "http://hl7.org/fhir/StructureMap/132067"
    }
  ]
}
