{
  "resourceType": "PlanDefinition",
  "id": "dc498810-cd49-4be6-92b6-2aa3625cb35a",
  "meta": {
    "versionId": "3",
    "lastUpdated": "2023-04-06T10:10:33.414+00:00",
    "source": "#0ef95191bc4952e9"
  },
  "contained": [
    {
      "resourceType": "ActivityDefinition",
      "id": "hiv_assessment_activity",
      "title": "HIV Assessment CarePlan",
      "description": "This is a task that will be generated for child < 5 years old.",
      "timingTiming": {
        "repeat": {
          "countMax": 1,
          "duration": 2,
          "durationMax": 4,
          "durationUnit": "h",
          "frequency": 1,
          "frequencyMax": 1,
          "period": 1,
          "periodMax": 1,
          "periodUnit": "mo"
        }
      }
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "hiv_screening_activity",
      "title": "HIV screening Referral Handler Activity",
      "status": "active",
      "description": "This action will assess CarePlan and generate referral task every time a followup happens on a task generated by plan",
      "kind": "Task"
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "hiv_linkage_activity",
      "title": "HIV Linkage Referral Handler Activity",
      "status": "active",
      "description": "This action will assess CarePlan and generate referral task every time a followup happens on a task generated by plan",
      "kind": "Task"
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "hiv_test_results_activity",
      "title": "HIV Test Results Referral Handler Activity",
      "status": "active",
      "description": "This action will assess CarePlan and generate referral task every time a followup happens on a task generated by plan",
      "kind": "Task"
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "hiv_referral_closure_activity",
      "title": "HIV Closure Referral Handler Activity",
      "status": "active",
      "description": "This action will assess CarePlan and generate referral task every time a followup happens on a task generated by plan",
      "kind": "Task"
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "hiv_adherence_counselling_activity",
      "title": "HIV adherence counselling Referral Handler Activity",
      "status": "active",
      "description": "This action will assess CarePlan and generate referral task every time a followup happens on a task generated by plan",
      "kind": "Task"
    }
  ],
  "name": "HIV Assessment",
  "title": "HIV Assessment",
  "status": "active",
  "description": "This action will assess careplan every time a HIV assessment happens on a task generated by plan.",
  "goal": [
    {
      "category": {
        "coding": [
          {
            "system": "https://www.hl7.org/fhir/codesystem-goal-category.html",
            "code": "nursing",
            "display": "Nursing"
          }
        ]
      },
      "priority": {
        "coding": [
          {
            "system": "https://www.hl7.org/fhir/codesystem-goal-priority.html",
            "code": "high-priority",
            "display": "High Priority"
          }
        ]
      },
      "start": {
        "coding": [
          {
            "system": "http://www.snomed.org/",
            "code": "32485007",
            "display": "Admission to hospital"
          }
        ]
      }
    }
  ],
  "action": [
    {
      "prefix": "hiv-assessment-task",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and %resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/45811c4c-c48e-491b-a8e3-5749322bf508').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='8265f18e-4f2c-4322-b0c8-7b9afe84baa2') and answer.value.code = 'no').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='e74c1a4a-6d3e-47ab-803f-5fb13c9e99dc') and answer.value.code = 'unknown').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='d2b2fd19-3273-4f2a-8169-145f9ecddd49') and answer.value.code = 'yes').exists()"
          }
        }
      ],
      "participant": [
        {
          "type": "practitioner",
          "role": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/practitioner-role",
                "code": "nurse",
                "display": "Nurse"
              }
            ]
          }
        }
      ],
      "type": {
        "coding": [
          {
            "code": "clinical-protocol",
            "display": "Clinical Protocol"
          }
        ]
      },
      "definitionCanonical": "#hiv_assessment_activity",
      "transform": "http://hl7.org/fhir/StructureMap/dbd5ebd6-3df6-4f2a-879c-d9c95f9d05ef"
    },
    {
      "prefix": "hiv-screening-task",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and %resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/45811c4c-c48e-491b-a8e3-5749322bf508').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='8265f18e-4f2c-4322-b0c8-7b9afe84baa2') and answer.value.code = 'no').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='e74c1a4a-6d3e-47ab-803f-5fb13c9e99dc') and answer.value.code = 'unknown').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='d2b2fd19-3273-4f2a-8169-145f9ecddd49') and answer.value.code = 'yes').exists()"
          }
        }
      ],
      "definitionCanonical": "#hiv_screening_activity",
      "transform": "http://hl7.org/fhir/StructureMap/bed1dba2-633c-41a3-8dcb-cc7195e310dc"
    },
    {
      "prefix": "hiv-linkage-task",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and (%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/45811c4c-c48e-491b-a8e3-5749322bf508').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/f16ce013-783e-496e-9277-6859d809dc9d').exists()) and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='c7db2997-d3c7-45d7-85af-a358ef1455f1') and answer.value.code = 'no').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='091aea0b-6334-4d8e-8086-c99b6f1ab602') and answer.value.code = 'no').exists()"
          }
        }
      ],
      "definitionCanonical": "#hiv_linkage_activity",
      "transform": "http://hl7.org/fhir/StructureMap/add7f7e1-4cb6-4e09-8edc-ccdb86d2330c"
    },
    {
      "prefix": "hiv-test-results-task",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and %resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/e74deb24-cc1c-4dcb-900a-af4ca608c403').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='d60b6209-102d-4008-ecbd-0a362a392ef9') and answer.value.code = 'yes').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='0dbbc54f-de7d-405e-96c6-375a992fe2f4') and answer.value.code = 'yes').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='542411f0-4fa9-4f7a-8389-6a70f3a994d0') and answer.value.code = 'yes').exists()"
          }
        }
      ],
      "definitionCanonical": "#hiv_test_results_activity",
      "transform": "http://hl7.org/fhir/StructureMap/9d4009c0-7c6c-4061-8d1a-01dc9a55c505"
    },
    {
      "prefix": "hiv-referral-closure-task",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and (%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/4ac9c519-d8df-473a-a3c2-1229c8ca1303').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='aa9260bd-1630-4b3a-b4b3-a15ed44e2e7c') and answer.value.code = 'positive').exists()) or (%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/413b4057-7038-4606-a5f9-3c51cc96d3ba').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='8a4e44f3-e132-436f-8895-4f4252270ad5') and answer.value.code = 'yes').exists())"
          }
        }
      ],
      "definitionCanonical": "#hiv_referral_closure_activity",
      "transform": "http://hl7.org/fhir/StructureMap/46c82c1d-6dbd-4d7c-a05a-c5bafdd48432"
    },
    {
      "prefix": "hiv-adherence-counselling-task",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and (%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/f16ce013-783e-496e-9277-6859d809dc9d').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/413b4057-7038-4606-a5f9-3c51cc96d3ba').exists()) and (%resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='091aea0b-6334-4d8e-8086-c99b6f1ab602') and answer.value.code = 'yes').exists() or %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId='e31f3e5a-e362-4fec-c0af-78dca13e9f28') and answer.value.code = 'yes').exists())"
          }
        }
      ],
      "definitionCanonical": "#hiv_adherence_counselling_activity",
      "transform": "http://hl7.org/fhir/StructureMap/f083b8e8-4abc-4872-b0a2-460aa21d310e"
    }
  ]
}