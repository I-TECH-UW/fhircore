"use strict";(self.webpackChunkfhircore=self.webpackChunkfhircore||[]).push([[916],{2974:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var t=i(5893),r=i(1151);const o={},s="Setting up Keycloak",a={id:"engineering/android-app/developer-setup/keycloak-auth-token-config",title:"Setting up Keycloak",description:"Keycloak auth token configuration",source:"@site/docs/engineering/android-app/developer-setup/keycloak-auth-token-config.md",sourceDirName:"engineering/android-app/developer-setup",slug:"/engineering/android-app/developer-setup/keycloak-auth-token-config",permalink:"/engineering/android-app/developer-setup/keycloak-auth-token-config",draft:!1,unlisted:!1,editUrl:"https://github.com/opensrp/fhircore/tree/main/docs/docs/engineering/android-app/developer-setup/keycloak-auth-token-config.md",tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Code Testing",permalink:"/engineering/android-app/developer-setup/code-testing"},next:{title:"Publishing FHIR SDK Library Artifacts",permalink:"/engineering/android-app/developer-setup/publishing-fhir-sdk-artifacts"}},l={},c=[{value:"Keycloak auth token configuration",id:"keycloak-auth-token-configuration",level:2},{value:"Configuring Keycloak with fhir-web",id:"configuring-keycloak-with-fhir-web",level:2},{value:"Extra notes",id:"extra-notes",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"setting-up-keycloak",children:"Setting up Keycloak"}),"\n",(0,t.jsx)(n.h2,{id:"keycloak-auth-token-configuration",children:"Keycloak auth token configuration"}),"\n",(0,t.jsx)(n.p,{children:"When making API requests, the app uses an access token that represent authorization to access resources on the server."}),"\n",(0,t.jsx)(n.p,{children:"When the access token expires, the app will attempt to renew it using a refresh token."}),"\n",(0,t.jsxs)(n.p,{children:["The access token lifespan is configured on Keycloak as the ",(0,t.jsx)(n.code,{children:"Access Token Lifespan"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The refresh token lifespan will be equal to the smallest value among (",(0,t.jsx)(n.code,{children:"SSO Session Idle"}),", ",(0,t.jsx)(n.code,{children:"Client Session Idle"}),", ",(0,t.jsx)(n.code,{children:"SSO Session Max"}),", and ",(0,t.jsx)(n.code,{children:"Client Session Max"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"When setting up identity and access management via Keycloak, the access and refresh token values are required to ensure the access token renewal works as expected in the app."}),"\n",(0,t.jsx)(n.h2,{id:"configuring-keycloak-with-fhir-web",children:"Configuring Keycloak with fhir-web"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Navigate to the Keycloak Admin UI, e.g ",(0,t.jsx)(n.code,{children:"http://keycloak:8080"})]}),"\n",(0,t.jsxs)(n.li,{children:["Create realm with name ",(0,t.jsx)(n.code,{children:"fhir"})," or anything else"]}),"\n",(0,t.jsxs)(n.li,{children:['In the realm previously created, create new Client Scope "fhir_core_app_id", set it as Default, and add mapper user attribute ',(0,t.jsx)(n.code,{children:"fhir_core_app_id"})]}),"\n",(0,t.jsxs)(n.li,{children:["Create client for OpenSRP v2.0 client-side application, e.g. ",(0,t.jsx)(n.code,{children:"opensrp-v2-app-client"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:['In "Capability config", turn on "Client authentication".',"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When it is ON, the OIDC type is set to confidential access type. When it is OFF, it is set to public access type)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:['Set "Valid redirect URIs" to ',(0,t.jsx)(n.code,{children:"*"})," or other as needed"]}),"\n",(0,t.jsx)(n.li,{children:'Copy & paste the client secret from "Credentials" tab'}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Create client for ",(0,t.jsx)(n.code,{children:"fhir-web"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'In "Capability config", turn on "Client authentication".'}),"\n",(0,t.jsxs)(n.li,{children:['Set "Valid redirect URIs" to the domain name of your ',(0,t.jsx)(n.code,{children:"fhir-web"})," installation + wildcard as suffix, e.g. ",(0,t.jsx)(n.code,{children:"https://fhir-web.example.org/*"})," or other as needed"]}),"\n",(0,t.jsxs)(n.li,{children:['Set "Valid post logout redirect URIs" to the domain name of your ',(0,t.jsx)(n.code,{children:"fhir-web"})," installation + wildcard as suffix, e.g. ",(0,t.jsx)(n.code,{children:"https://fhir-web.example.org/*"})," or other as needed"]}),"\n",(0,t.jsxs)(n.li,{children:['Set "Web origins" to the domain name of your ',(0,t.jsx)(n.code,{children:"fhir-web"})," installation, e.g. ",(0,t.jsx)(n.code,{children:"https://fhir-web.example.org"})," or other as needed"]}),"\n",(0,t.jsx)(n.li,{children:'Copy the client secret from the "Credentials" tab, paste it wherever needed'}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Create realm roles based on ",(0,t.jsx)(n.a,{href:"https://docs.google.com/document/d/1MEw41Rtfdmos9gqqDamQ31_Y58E8Thgo_8i9UXD8ET4/edit",children:"OpenSRP V2 RBAC ROLES"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"TODO:"})," Add script + payload to load all these to the Keycloak instance"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:['Create the groups "Super Admin" and "Provider"',"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Add roles in the "Role Mapping"'}),"\n",(0,t.jsxs)(n.li,{children:["Add attribute ",(0,t.jsx)(n.code,{children:"fhir_core_app_id"})," in the group, or in each user"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"extra-notes",children:"Extra notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Create users via ",(0,t.jsx)(n.code,{children:"fhir-web"}),'. This helps by automatically creating the additional required FHIR resources of "',(0,t.jsx)(n.a,{href:"http://hl7.org/fhir/R4/practitioner.html",children:"Practitioner"}),'" and "',(0,t.jsx)(n.a,{href:"http://hl7.org/fhir/R4/practitionerrole.html",children:"PractitionerRole"}),'" for new users / healthcare workers.']}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>a,a:()=>s});var t=i(7294);const r={},o=t.createContext(r);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);